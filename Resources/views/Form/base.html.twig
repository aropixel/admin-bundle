{% extends '@AropixelAdmin/base.html.twig' %}

{% if form is defined %}
{% form_theme form '@AropixelAdmin/Form/layout.html.twig' %}
{% endif %}

{% block stylesheets %}
    <link href="{{ asset('bundles/aropixeladmin/modules/cropper/cropper.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ asset('bundles/aropixeladmin/modules/pickadate/themes/default.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ asset('bundles/aropixeladmin/modules/pickadate/themes/default.date.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ asset('bundles/aropixeladmin/modules/jquery-clockpicker/bootstrap-clockpicker.min.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ asset('bundles/aropixeladmin/modules/bootstrap-select/css/bootstrap-select.min.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ asset('bundles/aropixeladmin/modules/spectrum/spectrum.css') }}" rel="stylesheet" type="text/css">
    {{ parent() }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/jqueryui-interactions.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/jquery.fitvids.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/ckeditor/ckeditor.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/ckeditor/simple-ckeditor.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/pickadate/picker.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/pickadate/legacy.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/pickadate/picker.date.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/jquery-clockpicker/bootstrap-clockpicker.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/bootstrap-select/js/bootstrap-select.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/spectrum/spectrum.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/spectrum/i18n/jquery.spectrum-fr.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/wysihtml5/wysihtml5.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/wysihtml5/toolbar.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/wysihtml5/parsers.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/wysihtml5/locales/bootstrap-wysihtml5.ua-UA.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/aropixeladmin/modules/cropper/cropper.min.js') }}"></script>
{% endblock %}

{% block header_elements %}
    {% set baseroute = get_baseroute() %}
    {% if route_exists(baseroute ~ '_index')  %}
        <a href="{{ path(baseroute ~ '_index') }}" class="fa-stack" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Liste">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-list fa-stack-1x fa-inverse"></i>
        </a>
    {% endif %}
    {% if app.request.get('_route') != baseroute ~ '_new' and route_exists(baseroute ~ '_new') %}
        <a href="{{ path(baseroute ~ '_new') }}" class="fa-stack" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Nouveau">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-plus fa-stack-1x fa-inverse"></i>
        </a>
    {% endif %}
    {% if form.vars.data.id and form.vars.data.createdAt  %}
        <a href="#" class="fa-stack" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="{{ "Créé le " ~ form.vars.data.createdAt|date('d-m-Y') ~ " à " ~ form.vars.data.createdAt|date('h:i') }}">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-info fa-stack-1x fa-inverse"></i>
        </a>
    {% endif %}
    {% if app.request.get('_route') != baseroute ~ '_delete' and route_exists(baseroute ~ '_delete') %}
        {% if form.vars.data.id is defined and form.vars.data.id %}
            <form method="post" class="d-inline-block" action="{{ path(baseroute ~ '_delete', {'id': form.vars.data.id}) }}">
                <button type="button" id="delete_button" class="fa-stack danger" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Supprimer">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-trash fa-stack-1x fa-inverse"></i>
                </button>
                <input type="hidden" name="_method" value="DELETE">
                <input type="hidden" name="_token" value="{{ csrf_token('delete_' ~ form.vars.unique_block_prefix ~ form.vars.data.id) }}">
                <input type="hidden" name="_token_prefix" value="{{ 'delete_' ~ form.vars.unique_block_prefix ~ form.vars.data.id }}">
            </form>
        {% endif %}
    {% endif %}
{% endblock %}

{% set has_tabs =
    block('tabbable') is defined or
    form.createdAt is defined or
    form.publishAt is defined or
    form.publishUntil is defined or
    form.slug is defined or
    form.status is defined or
    form.image is defined or
    form.files is defined
%}

{% set tabbableCollapsed = tabbableCollapsed is defined ? tabbableCollapsed : false %}

{% block header %}

    <div>
        <div class="d-flex align-items-center">
            <h1>{% block header_title %}{% endblock %}</h1>

            {% if block('header_elements') is defined %}
                {% set _elements = block('header_elements') %}
                <div class="heading-elements">
                    {{ _elements|raw }}
                </div>
            {% endif %}

        </div>

        <div class="section-header-breadcrumb">
            {% block header_breadcrumb %}{% endblock %}
        </div>
    </div>

    {% if has_tabs %}
        {% if block('tabbable') is defined %}
            {% set _navtabs = block('tabbable') %}
        {% endif %}
        <div class="tabbable {% if tabbableCollapsed %}collapsed {% endif %}">
            <ul class="nav nav-pills" role="tablist">
                {% if _navtabs is defined %}
                    {{ _navtabs|raw }}
                {% endif %}
                {% if form.image is defined  %}
                    <li class="nav-item"><a href="#panel-tab-image" data-bs-toggle="pill" class="nav-link"><i class="fas fa-image position-left"></i><span> Image</span></a></li>
                {% endif %}
                {% if form.files is defined  %}
                    <li class="nav-item"><a href="#panel-tab-files" data-bs-toggle="pill" class="nav-link"><i class="fas fa-files-o position-left"></i><span> Fichiers</span></a></li>
                {% endif %}
                {% if
                    form.createdAt is defined or
                    form.publishAt is defined or
                    form.publishUntil is defined or
                    form.slug is defined or
                    form.status is defined
                %}
                    <li class="nav-item"><a href="#panel-tab-publication" data-bs-toggle="pill" class="nav-link"><i class="fas fa-clock position-left"></i><span> Publication</span></a></li>
                {% endif %}
                <li>
                    <button class="btn btn-primary" form="aropixel_admin_form">Enregistrer</button>
                </li>
            </ul>
        </div>

    {% endif %}

{% endblock %}

{% block body -%}

    {% for flash_message in app.session.flashbag.get('notice') %}
    <div class="alert alert-success alert-dismissible alert-styled-left alert-arrow-left alert-bordered">
        {{ flash_message|raw }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}

    {% for flash_message in app.session.flashbag.get('error') %}
    <div class="alert alert-warning alert-dismissible alert-styled-left alert-arrow-left alert-bordered">
        {{ flash_message|raw }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}


    {% block panels %}

    {{ form_start(form, {'attr': {'data-form': 'form', 'id' : 'aropixel_admin_form'}}) }}

        {{ form_errors(form) }}

        <div{% if has_tabs %} class="panel-tab-content tab-content" {% endif %}>


            {% block mainPanel %}
                <!-- Form horizontal -->
                <div class="card">

                    {#<div class="card-header">
                        <h4 class="card-title">{% block formtitle %}{% endblock %}</h4>
                    </div>#}

                    <div class="card-body">

                        {% block formbody %}{% endblock %}

                    </div>

                </div>
            {% endblock %}

            {% block publication %}

                {% if
                    form.createdAt is defined or
                    form.publishAt is defined or
                    form.publishUntil is defined or
                    form.slug is defined or
                    form.status is defined
                %}


                    <div class="tab-pane fade" role="tabpanel" id="panel-tab-publication">

                        <div class="card card-centered">

                            <div class="card-body">

                                {% block publishSlug %}
                                    {% include '@AropixelAdmin/Form/sidebar_slug.html.twig' %}
                                {% endblock %}

                                {% block publishStatus %}
                                    {% include '@AropixelAdmin/Form/sidebar_status.html.twig' %}
                                {% endblock %}

                                {% block publishCreated %}
                                    {% include '@AropixelAdmin/Form/sidebar_date.html.twig' %}
                                {% endblock %}

                                {% if form.publishAt is defined or form.publishAt is defined %}

                                    {% block publishDates %}
                                        {% include '@AropixelAdmin/Form/sidebar_publish.html.twig' %}
                                    {% endblock %}

                                {% endif %}

                            </div>

                        </div>

                    </div>

                {% endif %}

            {% endblock %}

            {% block image %}

                {% if form.image is defined  %}
                <div class="tab-pane fade" role="tabpanel" id="panel-tab-image">
                    <div class="row">
                        <div class="col-3">
                            {% include '@AropixelAdmin/Form/sidebar_image.html.twig' %}
                        </div>
                    </div>
                </div>
                {% endif %}

            {% endblock %}

            {% block files %}

                {% if form.files is defined  %}
                    {% include '@AropixelAdmin/Form/sidebar_file.html.twig' %}
                {% endif %}

            {% endblock %}


        </div>
        {% block publishAction %}

            {% if not has_tabs %}

                {% if preview is defined and preview %}
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary" id="submitForm"><i class="icon-floppy-disk position-left"></i> Enregistrer</button>
                        <button class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown"> <span class="caret"></span> </button>
                        <ul class="dropdown-menu">
                            <li><a href="{{ preview }}" target="_blank">Aperçu</a></li>
                        </ul>
                    </div>
                {% else %}
                    <button type="submit" class="btn btn-primary heading-btn pull-right" data-form="submit" id="submitForm"><i class="icon-floppy-disk position-left"></i> Enregistrer</button>
                {% endif %}

            {% endif %}

        {% endblock %}

    {{ form_end(form) }}

    {% endblock %}

    {% block afterForm %}
    {% endblock %}


{% endblock %}
